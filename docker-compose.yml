version: '3.7' 
services: 
  ssh: 
    image: zulissi/dev_ssh # replace this with your repo
    deploy: 
      placement: 
        constraints: 
          - node.hostname == lambda-quad-3990-2080 # pick your computer
      resources:
        limits:
          cpus: '4'
          memory: 500M
    volumes:
      - zulissi-home:/home/zulissi # replace zulissi with your volume
    ports:
      - target: 22
        published: 2222 # pick your ssh port
        protocol: tcp
        mode: host
  jupyter: 
    image: zulissi/dev_gpu_jupyter # replace this with your repo
    deploy: 
      placement: 
        constraints: 
          - node.hostname == lambda-quad-3990-2080 # pick your computer
      resources:
        reservations:
          cpus: '16'
          memory: 8G
    volumes:
      - zulissi-home:/home/zulissi # replace zulissi with your volume
    ports:
      - target: 8888
        published: 9888 # pick your jupyter port
        protocol: tcp
        mode: host
    environment:
      - OMP_NUM_THREADS=1
        NUMEXPR_NUM_THREADS=1
        MKL_DEBUG_CPU_TYPE=5
        JUPYTER_ENABLE_LAB=yes
        NB_USER=zulissi
        NB_UID=1001
    shm_size: 1G


volumes:
  zulissi-home:
